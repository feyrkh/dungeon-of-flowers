[gd_scene load_steps=24 format=2]

[ext_resource path="res://combat/CombatScreen.gd" type="Script" id=1]
[ext_resource path="res://combat/Enemies.tscn" type="PackedScene" id=2]
[ext_resource path="res://combat/ShieldContainer.gd" type="Script" id=3]
[ext_resource path="res://combat/AllyPortraits.tscn" type="PackedScene" id=4]
[ext_resource path="res://art_exports/ui_battle/ui_battle_header.png" type="Texture" id=5]
[ext_resource path="res://combat/MinigameContainer.gd" type="Script" id=6]
[ext_resource path="res://font/NOTOSANS-CONDENSEDMEDIUM.TTF" type="DynamicFontData" id=7]
[ext_resource path="res://art_exports/button icons/ui_btn_pc_LEFT.png" type="Texture" id=8]
[ext_resource path="res://art_exports/ui_battle/ui_action_vignette.png" type="Texture" id=9]
[ext_resource path="res://util/TutorialTip.tscn" type="PackedScene" id=10]
[ext_resource path="res://img/ui/ui_button_A.tscn" type="PackedScene" id=11]
[ext_resource path="res://util/TutorialLabel.tscn" type="PackedScene" id=12]
[ext_resource path="res://util/Tutorial.gd" type="Script" id=13]
[ext_resource path="res://img/ui/ui_btn_pc_ESC.tscn" type="PackedScene" id=14]
[ext_resource path="res://img/ui/ui_btn_pc_LEFT.tscn" type="PackedScene" id=15]
[ext_resource path="res://img/ui/ui_btn_pc_RIGHT.tscn" type="PackedScene" id=16]
[ext_resource path="res://util/PausedTutorialTip.gd" type="Script" id=17]
[ext_resource path="res://util/DelayedTooltip.gd" type="Script" id=18]
[ext_resource path="res://art_exports/button icons/ui_btn_pc_RIGHT.png" type="Texture" id=19]

[sub_resource type="Animation" id=1]
resource_name = "fade_in"
length = 0.5
tracks/0/type = "value"
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.5 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Color( 1, 1, 1, 0 ), Color( 1, 1, 1, 1 ) ]
}

[sub_resource type="GDScript" id=2]
script/source = "extends Sprite

func _ready():
	CombatMgr.connect(\"show_battle_header\", self, \"on_show_battle_header\")
	CombatMgr.connect(\"hide_battle_header\", self, \"on_hide_battle_header\")

func on_show_battle_header(new_text):
	$BattleText.text = new_text
	$AnimationPlayer.play(\"slide_in\")

func on_hide_battle_header():
	#$BattleText.text = \"\"
	$AnimationPlayer.play_backwards(\"slide_in\")
"

[sub_resource type="DynamicFont" id=3]
size = 30
outline_size = 4
outline_color = Color( 0, 0, 0, 1 )
font_data = ExtResource( 7 )

[sub_resource type="Animation" id=4]
length = 0.5
tracks/0/type = "value"
tracks/0/path = NodePath(".:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.3 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector2( -364, 87 ), Vector2( 364, 87 ) ]
}

[node name="CombatScreen" type="Node2D"]
script = ExtResource( 1 )
__meta__ = {
"_edit_horizontal_guides_": [ 540.0 ],
"_edit_vertical_guides_": [ 2240.0 ]
}

[node name="Enemies" parent="." instance=ExtResource( 2 )]

[node name="ActionVignette" type="Sprite" parent="."]
modulate = Color( 1, 1, 1, 0 )
position = Vector2( 593, 0 )
texture = ExtResource( 9 )
centered = false
__meta__ = {
"_edit_lock_": true
}

[node name="AnimationPlayer" type="AnimationPlayer" parent="ActionVignette"]
anims/fade_in = SubResource( 1 )

[node name="AllyPortraits" parent="." instance=ExtResource( 4 )]

[node name="ShieldContainer" type="Node2D" parent="."]
script = ExtResource( 3 )
__meta__ = {
"_edit_lock_": true
}

[node name="BulletContainer" type="Node2D" parent="."]
__meta__ = {
"_edit_lock_": true
}

[node name="BattleHeader" type="Sprite" parent="."]
position = Vector2( -364, 87 )
texture = ExtResource( 5 )
script = SubResource( 2 )
__meta__ = {
"_edit_lock_": true
}

[node name="Label" type="Label" parent="BattleHeader"]
margin_left = -329.0
margin_top = -67.0
margin_right = -168.0
margin_bottom = -25.0
custom_fonts/font = SubResource( 3 )
text = "Action Phase"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="BattleText" type="Label" parent="BattleHeader"]
margin_left = -351.0
margin_top = -26.0
margin_right = 325.0
margin_bottom = 16.0
custom_fonts/font = SubResource( 3 )
text = "Grias is attacking!"
align = 2
__meta__ = {
"_edit_use_anchors_": false
}

[node name="AnimationPlayer" type="AnimationPlayer" parent="BattleHeader"]
anims/slide_in = SubResource( 4 )

[node name="MinigameContainer" type="CenterContainer" parent="."]
margin_left = 1920.0
margin_right = 2560.0
margin_bottom = 1080.0
rect_min_size = Vector2( 640, 1080 )
script = ExtResource( 6 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="MinigameCenter" type="Position2D" parent="MinigameContainer"]
position = Vector2( 320, 540 )

[node name="Tutorial" type="Control" parent="."]
margin_right = 40.0
margin_bottom = 40.0
script = ExtResource( 13 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="SelectCategory" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 741.0
margin_top = 574.0
margin_right = 1077.0
margin_bottom = 623.0

[node name="Label" parent="Tutorial/SelectCategory" instance=ExtResource( 12 )]
margin_right = 329.0
text = "Press     to select an Attack skill"

[node name="ui_button_A" parent="Tutorial/SelectCategory/Label" instance=ExtResource( 11 )]
position = Vector2( 67, 20 )

[node name="Line2D" type="Line2D" parent="Tutorial/SelectCategory"]
position = Vector2( -741, -406.056 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 815, 622, 811, 789.788 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="SelectSlashSkill" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 760.0
margin_top = 519.0
margin_right = 1128.0
margin_bottom = 568.0

[node name="Label" parent="Tutorial/SelectSlashSkill" instance=ExtResource( 12 )]
margin_right = 361.0
text = "Press     to select attack with Slash"

[node name="ui_button_A" parent="Tutorial/SelectSlashSkill/Label" instance=ExtResource( 11 )]
position = Vector2( 67, 20 )

[node name="Line2D" type="Line2D" parent="Tutorial/SelectSlashSkill"]
position = Vector2( -740, -435 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 922, 668.506, 922, 802.115 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="WrongCategoryFight" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 715.0
margin_top = 520.0
margin_right = 1195.0
margin_bottom = 569.0

[node name="Label" parent="Tutorial/WrongCategoryFight" instance=ExtResource( 12 )]
margin_right = 473.0
text = "Press     to go back and select the Fight menu"

[node name="ui_btn_pc_ESC" parent="Tutorial/WrongCategoryFight/Label" instance=ExtResource( 14 )]

[node name="WrongCategoryDefend" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.02647, 1.02647, 1.02647, 1 )
margin_left = 715.0
margin_top = 520.0
margin_right = 1195.0
margin_bottom = 569.0

[node name="Label" parent="Tutorial/WrongCategoryDefend" instance=ExtResource( 12 )]
margin_right = 473.0
text = "Press     to go back and select the Defend  menu"

[node name="ui_btn_pc_ESC" parent="Tutorial/WrongCategoryDefend/Label" instance=ExtResource( 14 )]

[node name="TargetEnemy" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 737.0
margin_top = 626.0
margin_right = 1197.0
margin_bottom = 675.0

[node name="Label" parent="Tutorial/TargetEnemy" instance=ExtResource( 12 )]
margin_right = 453.0
text = "Target an enemy with        , confirm with      "

[node name="ui_button_A" parent="Tutorial/TargetEnemy/Label" instance=ExtResource( 11 )]
position = Vector2( 431, 21 )

[node name="ui_btn_pc_LEFT" parent="Tutorial/TargetEnemy/Label" instance=ExtResource( 15 )]

[node name="ui_btn_pc_RIGHT" parent="Tutorial/TargetEnemy/Label" instance=ExtResource( 16 )]

[node name="Line2D" type="Line2D" parent="Tutorial/TargetEnemy"]
position = Vector2( -742, -435 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 1068, 600.897, 1427, 388.654 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="Line2D2" type="Line2D" parent="Tutorial/TargetEnemy"]
position = Vector2( -740, -435 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 835, 600.897, 505, 394.167 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="AttackMinigame" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 845.0
margin_top = 560.0
margin_right = 1305.0
margin_bottom = 799.0
script = ExtResource( 17 )

[node name="Label" parent="Tutorial/AttackMinigame" instance=ExtResource( 12 )]
margin_right = 453.0
margin_bottom = 232.0
text = "Play the minigame to strike the enemy!
Take note of the instructions, and try to
press      when the cursor hits the center of
the strike zone for max damage.
Missing will throw you off balance and 
make the next strike harder, so be careful!"

[node name="ui_button_A" parent="Tutorial/AttackMinigame/Label" instance=ExtResource( 11 )]
position = Vector2( 71, 96 )

[node name="Line2D" type="Line2D" parent="Tutorial/AttackMinigame"]
position = Vector2( -606, -370 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 1067, 602.276, 1181, 177.789 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="Line2D2" type="Line2D" parent="Tutorial/AttackMinigame"]
position = Vector2( -606, -370 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 1067, 600.898, 1317, 839.327 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="EnemyAttack" type="MarginContainer" parent="Tutorial"]
visible = false
margin_left = 1070.0
margin_top = 521.0
margin_right = 1577.0
margin_bottom = 646.0
script = ExtResource( 18 )
__meta__ = {
"_edit_use_anchors_": false
}
delayed_tutorial = "EnemyAttack_Delayed"

[node name="EnemyAttack_Delayed" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 1070.0
margin_top = 521.0
margin_right = 1577.0
margin_bottom = 646.0
script = ExtResource( 17 )

[node name="Label" parent="Tutorial/EnemyAttack_Delayed" instance=ExtResource( 12 )]
margin_right = 500.0
margin_bottom = 118.0
text = "The enemies are attacking! Grias left her shield
behind and won't be able to block right now.
Stay tough!"

[node name="SelectDefendCategory" parent="Tutorial" instance=ExtResource( 10 )]
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 722.752
margin_top = 411.593
margin_right = 1229.75
margin_bottom = 536.593

[node name="Label" parent="Tutorial/SelectDefendCategory" instance=ExtResource( 12 )]
margin_right = 500.0
margin_bottom = 118.0
text = "The enemies are going to attack Echinacea!
Luckily Grias has her shield now. 
Select the Defend skill menu to ready it."

[node name="Line2D" type="Line2D" parent="Tutorial/SelectDefendCategory/Label"]
position = Vector2( -1096.75, -497.058 )
scale = Vector2( 1, 0.526468 )
points = PoolVector2Array( 1364.08, 1553.86, 1324.83, 1163.09 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="SelectDefendSkill" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
margin_left = 760.0
margin_top = 519.0
margin_right = 1062.0
margin_bottom = 568.0

[node name="Label" parent="Tutorial/SelectDefendSkill" instance=ExtResource( 12 )]
margin_right = 295.0
text = "Press     to ready your shield"

[node name="ui_button_A" parent="Tutorial/SelectDefendSkill/Label" instance=ExtResource( 11 )]
position = Vector2( 67, 20 )

[node name="Line2D" type="Line2D" parent="Tutorial/SelectDefendSkill"]
position = Vector2( -740, -435 )
scale = Vector2( 1, 0.725581 )
points = PoolVector2Array( 922, 668.506, 922, 802.115 )
width = 3.0
default_color = Color( 0.290196, 0.290196, 0.290196, 1 )

[node name="UsingShield" type="MarginContainer" parent="Tutorial"]
visible = false
margin_left = 1070.0
margin_top = 521.0
margin_right = 1577.0
margin_bottom = 646.0
script = ExtResource( 18 )
__meta__ = {
"_edit_use_anchors_": false
}
delay = 1.0
delayed_tutorial = "UsingShield_Delayed"

[node name="UsingShield_Delayed" parent="Tutorial" instance=ExtResource( 10 )]
visible = false
modulate = Color( 1.31377, 1.31377, 1.31377, 1 )
margin_left = 761.696
margin_top = 465.908
margin_right = 1186.7
margin_bottom = 704.908
script = ExtResource( 17 )

[node name="Label" parent="Tutorial/UsingShield_Delayed" instance=ExtResource( 12 )]
margin_right = 418.0
margin_bottom = 232.0
text = "The enemy attacks are incoming!
Use          to move your shield into
position to block.
If your shield has enough durability
left after the attack, it will be available
during your next round!"

[node name="ui_button_LEFT" parent="Tutorial/UsingShield_Delayed/Label" instance=ExtResource( 11 )]
position = Vector2( 52.8577, 56.7695 )
scale = Vector2( 0.33, 0.33 )
texture = ExtResource( 8 )

[node name="ui_button_RIGHT" parent="Tutorial/UsingShield_Delayed/Label" instance=ExtResource( 11 )]
position = Vector2( 72.1738, 56.6401 )
scale = Vector2( 0.33, 0.33 )
texture = ExtResource( 19 )

[connection signal="player_move_selected" from="." to="." method="_on_CombatScreen_player_move_selected"]
[connection signal="start_combat" from="." to="." method="_on_CombatScreen_start_combat"]
[connection signal="single_enemy_target_complete" from="Enemies" to="." method="_on_Enemies_single_enemy_target_complete"]
[connection signal="target_cancelled" from="Enemies" to="." method="_on_Enemies_target_cancelled"]
[connection signal="self_target_complete" from="AllyPortraits" to="." method="_on_AllyPortraits_self_target_complete"]
[connection signal="target_cancelled" from="AllyPortraits" to="." method="_on_AllyPortraits_target_cancelled"]
